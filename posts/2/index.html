
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="Summary The struct worker is the really scheudle unit in workqueue.
Each struct worker has a corresponding thread(task) by worker-&gt;task.
A struct &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://martinbj2008.github.io/posts/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" -->
<!-- link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" -->

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="martinbj2008.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/18/worker-and-worker-thread/">Worker and Worker_thread</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-18T11:40:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:40 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Summary</h3>

<p>The <code>struct worker</code> is the really scheudle unit in workqueue.
Each <code>struct worker</code> has a corresponding thread(task) by <code>worker-&gt;task</code>.
A <code>struct worker</code> is linked to <code>struct worker_pool-&gt;idle_list</code> when work is idle.
and moved to <code>struct worker_pool-&gt;busy_hash</code>.</p>

<h3><code>worker_thread</code></h3>

<ol>
<li>move <code>worker</code> from <code>pool-&gt;idle_list</code> and clear <code>worker</code> &rsquo;s <code>WORKER_IDLE</code> flag.</li>
<li>check the <code>pool</code> and manage the workers(create/destory)</li>
<li>Iterate all the <code>struct work_struct *work</code> in the <code>struct worker_pool-&gt;worklist</code>,
and run them in sequence with <code>process_one_work(worker, work);</code>.</li>
<li>move <code>worker</code> into idle list again.</li>
<li>schedule();</li>
</ol>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/02/18/worker-and-worker-thread/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/12/workqueue-basic-structure/">Workqueue Basic Structure</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-12T18:19:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:19 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>summary</h3>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/02/12/workqueue-basic-structure/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/11/dst-garbage/">Dst Garbage</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-11T14:22:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:22 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>dst garbage summary</h3>

<p><code>garbage collection</code> is a common method used in kernel.
When a object(struct,memeory) become invalid, we need
free them, but the object maybe reference by others.</p>

<p>such as a <code>dst_entry</code> is not invalid, and it is still
referenced(used) by others.</p>

<p>then <code>__dst_free</code> will be called for this case.
It will first set <code>dst</code> to dirty(dead),
and then put it into <code>dst_garbage.list</code> by <code>dst-&gt;next</code>.</p>

<p>Then a workqueue task will check the <code>dst</code>&rsquo;s reference,
and free(destory) it when no reference on it.</p>

<p>Two key struct <strong><code>struct dst_garbage</code></strong> and <strong><code>dst_gc_work</code></strong></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/02/11/dst-garbage/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/10/dst-ops/">Dst Ops</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-10T15:31:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>3:31 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Call trace</h3>

<p>forward a packet.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&gt;</span> <span class="n">ip_rcv_finish</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ip_route_input_noref</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ip_route_input_slow</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">fib_lookup</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ip_mkroute_input</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">dst_input</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ip_mkroute_input</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">__mkroute_input</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">rth</span> <span class="o">=</span> <span class="n">rt_dst_alloc</span><span class="p">(...)</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">skb_dst_set</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rth</span><span class="o">-&gt;</span><span class="n">dst</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/02/10/dst-ops/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/08/qdisc-running-flag/">Qdisc Running Flag</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-08T11:26:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:26 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Summary</h3>

<p>In <code>struct Qdisc</code>, there are two similar fileds.
running flag is stored in <strong><code>__state</code></strong> of <code>struct Qdisc</code>, NOT <strong><code>state</code></strong>.
Every time, when we send a packet from qdisc, the <code>running</code> flag is
set by <code>qdisc_run_begin</code>, and after that, it is removed by <code>qdisc_run_end</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="mi">84</span>         <span class="kt">unsigned</span> <span class="kt">long</span>           <span class="n">state</span><span class="p">;</span>
</span><span class='line'> <span class="p">...</span>
</span><span class='line'> <span class="mi">87</span>         <span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">__state</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>todo</h4>

<p> why need busylock?</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/02/08/qdisc-running-flag/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/08/how-to-xmit-a-packet-with-qdisc/">How to Xmit a Packet With Qdisc</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-08T11:26:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:26 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>summary</h3>

<p>We think it as a ideal and simple case:</p>

<h3>Call Trace:</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&gt;</span> <span class="n">dev_queue_xmit</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span>  <span class="n">__dev_queue_xmit</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">rcu_read_lock_bh</span><span class="p">();</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">txq</span> <span class="o">=</span> <span class="n">netdev_pick_tx</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">skb</span><span class="p">,</span> <span class="n">accel_priv</span><span class="p">);</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">q</span> <span class="o">=</span> <span class="n">rcu_dereference_bh</span><span class="p">(</span><span class="n">txq</span><span class="o">-&gt;</span><span class="n">qdisc</span><span class="p">);</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">__dev_xmit_skb</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">txq</span><span class="p">);</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">skb_dst_force</span><span class="p">(</span><span class="n">skb</span><span class="p">);</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">enqueue</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">q</span><span class="p">);</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">qdisc_run_begin</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span>  <span class="n">__qdisc_run</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="k">while</span> <span class="p">(</span><span class="n">qdisc_restart</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">__netif_schedule</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">qdisc_run_end</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">rcu_read_unlock_bh</span><span class="p">();</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/02/08/how-to-xmit-a-packet-with-qdisc/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/28/how-to-create-dev-qdisc/">How to Create Dev Qdisc</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-28T13:47:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:47 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Summary</h2>

<h3>Part 1: Register multi queue net device.</h3>

<p>In this part, only the framework is prepared for qdisc,
and the <code>noop_qdisc</code> is set as default.</p>

<h4>prepare <code>netdev_queue</code>s.</h4>

<p>for example: intel igb hardware has 8 hardware tx queue,
and nic driver create 8 corresponding <code>struct netdev_queue</code>
in the <code>_tx</code> of <code>struct net_device</code>.</p>

<h4>prepare <code>mq_qdisc</code></h4>

<p>The <code>mq_qdisc</code> is attached to the corresponding device.
In <code>mq_qdisc</code> private field, a default qdisc will be
create for <strong>each</strong> NIC&rsquo;s hardware queue.
This is done in <code>mq_init</code>.
The default qdisc is <code>pfifo_fast_ops</code>.</p>

<h4>attach <code>mq_qdisc</code> to <code>netdev_queue</code>.</h4>

<p>In <code>mq_attach</code>, these qdiscs are attatched to corresponding
<code>struct netdev_queue</code>.</p>

<h3>Part 2: Active a net device with right qdiscs</h3>

<p>Here only trace with the case <code>mq_qdisc</code>.
When dev is up, <code>dev_open</code> is called, which will call <code>dev_activate</code>.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/01/28/how-to-create-dev-qdisc/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/28/qdisc-study-part1-qdisc-base/">Qdisc Study Part1: Qdisc_base</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-28T11:30:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:30 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3><code>Qdisc_ops</code> is the core of  a Qdisc.</h3>

<p>All kinds of the <code>Qdisc_ops</code> are linked in a list by <code>qdisc_base</code>.
The <strong>key</strong> item of different <code>Qdisc_ops</code> is <code>id[IFNAMSIZ]</code>.</p>

<p>Note: the list is a Singly-linked list, not a common list of kernel.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">158</span> <span class="k">struct</span> <span class="n">Qdisc_ops</span> <span class="p">{</span>
</span><span class='line'><span class="mi">159</span>         <span class="k">struct</span> <span class="n">Qdisc_ops</span>        <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'><span class="mi">160</span>         <span class="k">const</span> <span class="k">struct</span> <span class="n">Qdisc_class_ops</span>    <span class="o">*</span><span class="n">cl_ops</span><span class="p">;</span>
</span><span class='line'><span class="mi">161</span>         <span class="kt">char</span>                    <span class="n">id</span><span class="p">[</span><span class="n">IFNAMSIZ</span><span class="p">];</span>
</span><span class='line'><span class="mi">162</span>         <span class="kt">int</span>                     <span class="n">priv_size</span><span class="p">;</span>
</span><span class='line'><span class="mi">163</span>
</span><span class='line'><span class="mi">164</span>         <span class="nf">int</span>                     <span class="p">(</span><span class="o">*</span><span class="n">enqueue</span><span class="p">)(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">165</span>         <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span>        <span class="p">(</span><span class="o">*</span><span class="n">dequeue</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">166</span>         <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span>        <span class="p">(</span><span class="o">*</span><span class="n">peek</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">167</span>         <span class="kt">unsigned</span> <span class="nf">int</span>            <span class="p">(</span><span class="o">*</span><span class="n">drop</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">168</span>
</span><span class='line'><span class="mi">169</span>         <span class="nf">int</span>                     <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nlattr</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>
</span><span class='line'><span class="mi">170</span>         <span class="nf">void</span>                    <span class="p">(</span><span class="o">*</span><span class="n">reset</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">171</span>         <span class="nf">void</span>                    <span class="p">(</span><span class="o">*</span><span class="n">destroy</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">172</span>         <span class="nf">int</span>                     <span class="p">(</span><span class="o">*</span><span class="n">change</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nlattr</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>
</span><span class='line'><span class="mi">173</span>         <span class="nf">void</span>                    <span class="p">(</span><span class="o">*</span><span class="n">attach</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">174</span>
</span><span class='line'><span class="mi">175</span>         <span class="nf">int</span>                     <span class="p">(</span><span class="o">*</span><span class="n">dump</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">176</span>         <span class="nf">int</span>                     <span class="p">(</span><span class="o">*</span><span class="n">dump_stats</span><span class="p">)(</span><span class="k">struct</span> <span class="n">Qdisc</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">gnet_dump</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'><span class="mi">177</span>
</span><span class='line'><span class="mi">178</span>         <span class="k">struct</span> <span class="n">module</span>           <span class="o">*</span><span class="n">owner</span><span class="p">;</span>
</span><span class='line'><span class="mi">179</span> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h3><code>qdisc_base</code></h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="mi">134</span> <span class="cm">/* The list of all installed queueing disciplines. */</span>
</span><span class='line'> <span class="mi">135</span>
</span><span class='line'> <span class="mi">136</span> <span class="k">static</span> <span class="k">struct</span> <span class="n">Qdisc_ops</span> <span class="o">*</span><span class="n">qdisc_base</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/01/28/qdisc-study-part1-qdisc-base/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/27/how-to-remember-ip-slash-tcp-slash-udp-header/">How to Remember Ip/tcp/udp Header</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-27T14:25:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:25 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>IP HEADER</h3>

<p>以前找工作时，常被问到IP头都有哪些字段？
现在觉得真的理解了记起来没那么难。</p>

<p>上路时总要记得终点和起点(src/dst ip),
要倒几次车，大体也知道（ttl).</p>

<p>路有大路有小路，有高速路和土路。
大路到小路要分片，小路到大路可能重组。
上高速路需要通行证（qos/tos).</p>

<p>路上有警察，查你是不是非法(csum, header len, ip option)，
查你装的什么货(protocol)？</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/01/27/how-to-remember-ip-slash-tcp-slash-udp-header/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/14/how-tcp-server-accept-a-new-connection-request/">How Tcp Server Accept a New Connection Request</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-14T16:01:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:01 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Two packets will be proessed by tcp server side:
1. SYN
2. ACK</p>

<p>For the first packet(syn) of handshake, it first lookup the listen socket,
and create a req socket as temporary.</p>

<p>For the third packet(ack) of handshake, it will match the req socket created
in previous steps.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/01/14/how-tcp-server-accept-a-new-connection-request/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/10/21/ftrace-study/">Ftrace Study</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/17/netdevice-watchdog-cause-tx-queue-schedule/">Netdevice Watchdog Cause Tx Queue Schedule</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/16/ixgbe-queue-index/">How Does Ixgbe Use Queue Index</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/14/tcpdump-work-with-bonding-interface/">Tcpdump Work With Bonding Interface</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/31/how-to-select-source-ip-for-a-tcp-socket/">How to Select Source Ip for a Tcp Socket</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/martinbj2008@gmail.com">@martinbj2008@gmail.com</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'martinbj2008@gmail.com',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
